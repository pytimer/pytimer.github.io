<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Software Develper, **Like Go and Cloud** Golang developer China Pytimer https://raw.githubusercontent.com/pytimer/pytimer.github.io/master/gopher.png ">
<meta name="description" content="安装1.13.0-beta.2 安装必要组件 init apiVersion: kubeadm.k8s.io/v1beta1 kind: InitConfiguration bootstrapTokens: - groups: - system:bootstrappers:kubeadm:default-node-token ttl: 24h0m0s usages: - signing - authentication localAPIEndpoint: advertiseAddress: 0.0.0.0 bindPort: 6443 nodeRegistration: criSocket: /var/run/dockershim.sock name: master212 taints: - effect: NoSchedule key: node-role.kubernetes.io/master --- apiServer: timeoutForControlPlane: 4m0s apiVersion: kubeadm.k8s.io/v1beta1 kind: ClusterConfiguration certificatesDir: /etc/kubernetes/pki clusterName: kubernetes controlPlaneEndpoint: &amp;#34;${VIP}&amp;#34; controllerManager: {} dns: type: CoreDNS etcd: local: serverCertSANs: - &amp;#34;${VIP}&amp;#34; extraArgs: cipher-suites: TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 dataDir: /var/lib/etcd imageRepository: k8s.gcr.io kubernetesVersion: v1.13.0-beta.2 networking: dnsDomain: cluster." />
<meta name="keywords" content="homepage, blog, kubeadm, CNCF" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://pytimer.github.io/post/kubernetes/kubeadm/" />


    <title>
        
            Install Kubernetes cluster with Kubeadm :: Pytimer Blog 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.d1ea4af8fd04fb24a4f8b882ea54bd04eb245427ca4baf527c81a5dab071410b.css">






<meta itemprop="name" content="Install Kubernetes cluster with Kubeadm">
<meta itemprop="description" content="安装1.13.0-beta.2 安装必要组件 init apiVersion: kubeadm.k8s.io/v1beta1 kind: InitConfiguration bootstrapTokens: - groups: - system:bootstrappers:kubeadm:default-node-token ttl: 24h0m0s usages: - signing - authentication localAPIEndpoint: advertiseAddress: 0.0.0.0 bindPort: 6443 nodeRegistration: criSocket: /var/run/dockershim.sock name: master212 taints: - effect: NoSchedule key: node-role.kubernetes.io/master --- apiServer: timeoutForControlPlane: 4m0s apiVersion: kubeadm.k8s.io/v1beta1 kind: ClusterConfiguration certificatesDir: /etc/kubernetes/pki clusterName: kubernetes controlPlaneEndpoint: &#34;${VIP}&#34; controllerManager: {} dns: type: CoreDNS etcd: local: serverCertSANs: - &#34;${VIP}&#34; extraArgs: cipher-suites: TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 dataDir: /var/lib/etcd imageRepository: k8s.gcr.io kubernetesVersion: v1.13.0-beta.2 networking: dnsDomain: cluster.">
<meta itemprop="datePublished" content="2018-12-03T16:58:17+08:00" />
<meta itemprop="dateModified" content="2018-12-03T16:58:17+08:00" />
<meta itemprop="wordCount" content="1258">
<meta itemprop="image" content="https://pytimer.github.io/"/>



<meta itemprop="keywords" content="kubeadm,CNCF," />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://pytimer.github.io/"/>

<meta name="twitter:title" content="Install Kubernetes cluster with Kubeadm"/>
<meta name="twitter:description" content="安装1.13.0-beta.2 安装必要组件 init apiVersion: kubeadm.k8s.io/v1beta1 kind: InitConfiguration bootstrapTokens: - groups: - system:bootstrappers:kubeadm:default-node-token ttl: 24h0m0s usages: - signing - authentication localAPIEndpoint: advertiseAddress: 0.0.0.0 bindPort: 6443 nodeRegistration: criSocket: /var/run/dockershim.sock name: master212 taints: - effect: NoSchedule key: node-role.kubernetes.io/master --- apiServer: timeoutForControlPlane: 4m0s apiVersion: kubeadm.k8s.io/v1beta1 kind: ClusterConfiguration certificatesDir: /etc/kubernetes/pki clusterName: kubernetes controlPlaneEndpoint: &#34;${VIP}&#34; controllerManager: {} dns: type: CoreDNS etcd: local: serverCertSANs: - &#34;${VIP}&#34; extraArgs: cipher-suites: TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 dataDir: /var/lib/etcd imageRepository: k8s.gcr.io kubernetesVersion: v1.13.0-beta.2 networking: dnsDomain: cluster."/>





    <meta property="article:section" content="cloud" />

    <meta property="article:section" content="Kubernetes" />



    <meta property="article:published_time" content="2018-12-03 16:58:17 &#43;0800 CST" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://pytimer.github.io/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">hello</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://pytimer.github.io/post/kubernetes/kubeadm/">Install Kubernetes cluster with Kubeadm</a></h2>

            

            <div class="post-content">
                <h1 id="安装1130-beta2">安装1.13.0-beta.2</h1>
<h2 id="安装必要组件">安装必要组件</h2>
<h2 id="init">init</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: kubeadm.k8s.io/v1beta1
<span style="color:#66d9ef">kind</span>: InitConfiguration
<span style="color:#66d9ef">bootstrapTokens</span>:
- <span style="color:#66d9ef">groups</span>:
  - system:bootstrappers:kubeadm:default-node-token
  <span style="color:#66d9ef">ttl</span>: 24h0m0s
  <span style="color:#66d9ef">usages</span>:
  - signing
  - authentication
<span style="color:#66d9ef">localAPIEndpoint</span>:
  <span style="color:#66d9ef">advertiseAddress</span>: <span style="color:#ae81ff">0.0.0.0</span>
  <span style="color:#66d9ef">bindPort</span>: <span style="color:#ae81ff">6443</span>
<span style="color:#66d9ef">nodeRegistration</span>:
  <span style="color:#66d9ef">criSocket</span>: /var/run/dockershim.sock
  <span style="color:#66d9ef">name</span>: master212
  <span style="color:#66d9ef">taints</span>:
  - <span style="color:#66d9ef">effect</span>: NoSchedule
    <span style="color:#66d9ef">key</span>: node-role.kubernetes.io/master
---
<span style="color:#66d9ef">apiServer</span>:
  <span style="color:#66d9ef">timeoutForControlPlane</span>: 4m0s
<span style="color:#66d9ef">apiVersion</span>: kubeadm.k8s.io/v1beta1
<span style="color:#66d9ef">kind</span>: ClusterConfiguration
<span style="color:#66d9ef">certificatesDir</span>: /etc/kubernetes/pki
<span style="color:#66d9ef">clusterName</span>: kubernetes
<span style="color:#66d9ef">controlPlaneEndpoint</span>: <span style="color:#e6db74">&#34;${VIP}&#34;</span>
<span style="color:#66d9ef">controllerManager</span>: {}
<span style="color:#66d9ef">dns</span>:
  <span style="color:#66d9ef">type</span>: CoreDNS
<span style="color:#66d9ef">etcd</span>:
  <span style="color:#66d9ef">local</span>:
    <span style="color:#66d9ef">serverCertSANs</span>:
    - <span style="color:#e6db74">&#34;${VIP}&#34;</span>
    <span style="color:#66d9ef">extraArgs</span>:
      <span style="color:#66d9ef">cipher-suites</span>: TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
    <span style="color:#66d9ef">dataDir</span>: /var/lib/etcd
<span style="color:#66d9ef">imageRepository</span>: k8s.gcr.io
<span style="color:#66d9ef">kubernetesVersion</span>: v1<span style="color:#ae81ff">.13.0</span>-beta<span style="color:#ae81ff">.2</span>
<span style="color:#66d9ef">networking</span>:
  <span style="color:#66d9ef">dnsDomain</span>: cluster.local
  <span style="color:#66d9ef">podSubnet</span>: <span style="color:#e6db74">&#34;10.244.0.0/16&#34;</span>
  <span style="color:#66d9ef">serviceSubnet</span>: <span style="color:#ae81ff">10.96.0.0</span>/<span style="color:#ae81ff">12</span>

</code></pre></div><h3 id="下载镜像">下载镜像</h3>
<p><code>kubeadm config images pull --config kubeadm.yaml</code></p>
<h3 id="init-1">init</h3>
<pre><code>[root@localhost ~]# kubeadm init --config kubeadm.yaml
[init] Using Kubernetes version: v1.13.0-beta.2
[preflight] Running pre-flight checks
        [WARNING SystemVerification]: this Docker version is not on the list of validated versions: 18.03.1-ce. Latest validated version: 18.06
[preflight] Pulling images required for setting up a Kubernetes cluster
[preflight] This might take a minute or two, depending on the speed of your internet connection
[preflight] You can also perform this action in beforehand using 'kubeadm config images pull'
[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;
[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
[kubelet-start] Activating the kubelet service
[certs] Using certificateDir folder &quot;/etc/kubernetes/pki&quot;
[certs] Generating &quot;ca&quot; certificate and key
[certs] Generating &quot;apiserver&quot; certificate and key
[certs] apiserver serving cert is signed for DNS names [master212 kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 ${VIP}]
[certs] Generating &quot;apiserver-kubelet-client&quot; certificate and key
[certs] Generating &quot;etcd/ca&quot; certificate and key
[certs] Generating &quot;etcd/peer&quot; certificate and key
[certs] etcd/peer serving cert is signed for DNS names [master212 localhost] and IPs [xxx 127.0.0.1 ::1]
[certs] Generating &quot;etcd/healthcheck-client&quot; certificate and key
[certs] Generating &quot;apiserver-etcd-client&quot; certificate and key
[certs] Generating &quot;etcd/server&quot; certificate and key
[certs] etcd/server serving cert is signed for DNS names [master212 localhost] and IPs [xxx 127.0.0.1 ::1 ${VIP}]
[certs] Generating &quot;front-proxy-ca&quot; certificate and key
[certs] Generating &quot;front-proxy-client&quot; certificate and key
[certs] Generating &quot;sa&quot; key and public key
[kubeconfig] Using kubeconfig folder &quot;/etc/kubernetes&quot;
[kubeconfig] Writing &quot;admin.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;kubelet.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;controller-manager.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;scheduler.conf&quot; kubeconfig file
[control-plane] Using manifest folder &quot;/etc/kubernetes/manifests&quot;
[control-plane] Creating static Pod manifest for &quot;kube-apiserver&quot;
[control-plane] Creating static Pod manifest for &quot;kube-controller-manager&quot;
[control-plane] Creating static Pod manifest for &quot;kube-scheduler&quot;
[etcd] Creating static Pod manifest for local etcd in &quot;/etc/kubernetes/manifests&quot;
[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &quot;/etc/kubernetes/manifests&quot;. This can take up to 4m0s
[apiclient] All control plane components are healthy after 19.002802 seconds
[uploadconfig] storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace
[kubelet] Creating a ConfigMap &quot;kubelet-config-1.13&quot; in namespace kube-system with the configuration for the kubelets in the cluster
[patchnode] Uploading the CRI Socket information &quot;/var/run/dockershim.sock&quot; to the Node API object &quot;master212&quot; as an annotation
[mark-control-plane] Marking the node master212 as control-plane by adding the label &quot;node-role.kubernetes.io/master=''&quot;
[mark-control-plane] Marking the node master212 as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]
[bootstrap-token] Using token: 1jvhzl.37osma939vn5q1uh
[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
[bootstraptoken] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
[bootstraptoken] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
[bootstraptoken] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
[bootstraptoken] creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace
[addons] Applied essential addon: CoreDNS
[addons] Applied essential addon: kube-proxy

Your Kubernetes master has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

You should now deploy a pod network to the cluster.
Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

You can now join any number of machines by running the following on each node
as root:

  kubeadm join ${VIP}:6443 --token 1jvhzl.37osma939vn5q1uh --discovery-token-ca-cert-hash sha256:d39872f0d591e1b01ff3590d2a42030bc47b25baaf2748d4862636e8e0accbe9

</code></pre><p>执行完后，查看pod状态为：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod -n kube-system</span>
NAME                                READY   STATUS              RESTARTS   AGE
coredns-576cbf47c7-d6nnc            0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          101s
coredns-576cbf47c7-g9zgf            0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          101s
etcd-master212                      1/1     Running             <span style="color:#ae81ff">0</span>          53s
kube-apiserver-master212            1/1     Running             <span style="color:#ae81ff">0</span>          47s
kube-controller-manager-master212   1/1     Running             <span style="color:#ae81ff">0</span>          60s
kube-proxy-wqdb2                    1/1     Running             <span style="color:#ae81ff">0</span>          101s
kube-scheduler-master212            1/1     Running             <span style="color:#ae81ff">0</span>          46s
</code></pre></div><h3 id="安装flannel">安装flannel</h3>
<p><code>kubectl apply -f flannel.yml</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod -n kube-system</span>
NAME                                READY   STATUS    RESTARTS   AGE
coredns-576cbf47c7-d6nnc            1/1     Running   <span style="color:#ae81ff">0</span>          4m11s
coredns-576cbf47c7-g9zgf            1/1     Running   <span style="color:#ae81ff">0</span>          4m11s
etcd-master212                      1/1     Running   <span style="color:#ae81ff">0</span>          3m23s
kube-apiserver-master212            1/1     Running   <span style="color:#ae81ff">0</span>          3m17s
kube-controller-manager-master212   1/1     Running   <span style="color:#ae81ff">0</span>          3m30s
kube-flannel-ds-amd64-7lldk         1/1     Running   <span style="color:#ae81ff">0</span>          48s
kube-proxy-wqdb2                    1/1     Running   <span style="color:#ae81ff">0</span>          4m11s
kube-scheduler-master212            1/1     Running   <span style="color:#ae81ff">0</span>          3m16s
</code></pre></div><h3 id="添加新的master">添加新的Master</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: kubeadm.k8s.io/v1beta1
<span style="color:#66d9ef">kind</span>: JoinConfiguration
<span style="color:#66d9ef">caCertPath</span>: /etc/kubernetes/pki/ca.crt
<span style="color:#66d9ef">discovery</span>:
  <span style="color:#66d9ef">bootstrapToken</span>:
    <span style="color:#66d9ef">apiServerEndpoint</span>: ${VIP}:<span style="color:#ae81ff">6443</span>
    <span style="color:#66d9ef">token</span>: 1jvhzl.37osma939vn5q1uh
    <span style="color:#66d9ef">unsafeSkipCAVerification</span>: <span style="color:#66d9ef">true</span>
  <span style="color:#66d9ef">timeout</span>: 5m0s
  <span style="color:#66d9ef">tlsBootstrapToken</span>: 1jvhzl.37osma939vn5q1uh
<span style="color:#66d9ef">controlPlane</span>:
  <span style="color:#66d9ef">localAPIEndpoint</span>:
    <span style="color:#66d9ef">advertiseAddress</span>: <span style="color:#ae81ff">0.0.0.0</span>
    <span style="color:#66d9ef">bindPort</span>: <span style="color:#ae81ff">6443</span>
<span style="color:#66d9ef">nodeRegistration</span>:
  <span style="color:#66d9ef">criSocket</span>: /var/run/dockershim.sock
  <span style="color:#66d9ef">name</span>: master213
</code></pre></div><p><code>kubeadm join --experimental-control-plane --config kubeadm.yaml</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@master213 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubeadm join --experimental-control-plane --config kubeadm.yaml</span>
<span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> Running pre-flight checks
        <span style="color:#f92672">[</span>WARNING SystemVerification<span style="color:#f92672">]</span>: this Docker version is not on the list of validated versions: 18.03.1-ce. Latest validated version: 18.06
<span style="color:#f92672">[</span>discovery<span style="color:#f92672">]</span> Trying to connect to API Server <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>VIP<span style="color:#e6db74">}</span><span style="color:#e6db74">:6443&#34;</span>
<span style="color:#f92672">[</span>discovery<span style="color:#f92672">]</span> Created cluster-info discovery client, requesting info from <span style="color:#e6db74">&#34;https://</span><span style="color:#e6db74">${</span>VIP<span style="color:#e6db74">}</span><span style="color:#e6db74">:6443&#34;</span>
<span style="color:#f92672">[</span>discovery<span style="color:#f92672">]</span> Cluster info signature and contents are valid and no TLS pinning was specified, will use API Server <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>VIP<span style="color:#e6db74">}</span><span style="color:#e6db74">:6443&#34;</span>
<span style="color:#f92672">[</span>discovery<span style="color:#f92672">]</span> Successfully established connection with API Server <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>VIP<span style="color:#e6db74">}</span><span style="color:#e6db74">:6443&#34;</span>
<span style="color:#f92672">[</span>join<span style="color:#f92672">]</span> Reading configuration from the cluster...
<span style="color:#f92672">[</span>join<span style="color:#f92672">]</span> FYI: You can look at this config file with <span style="color:#e6db74">&#39;kubectl -n kube-system get cm kubeadm-config -oyaml&#39;</span>
<span style="color:#f92672">[</span>join<span style="color:#f92672">]</span> Running pre-flight checks before initializing the new control plane instance
        <span style="color:#f92672">[</span>WARNING SystemVerification<span style="color:#f92672">]</span>: this Docker version is not on the list of validated versions: 18.03.1-ce. Latest validated version: 18.06
<span style="color:#f92672">[</span>certs<span style="color:#f92672">]</span> Generating <span style="color:#e6db74">&#34;front-proxy-client&#34;</span> certificate and key
<span style="color:#f92672">[</span>certs<span style="color:#f92672">]</span> Generating <span style="color:#e6db74">&#34;etcd/peer&#34;</span> certificate and key
<span style="color:#f92672">[</span>certs<span style="color:#f92672">]</span> etcd/peer serving cert is signed <span style="color:#66d9ef">for</span> DNS names <span style="color:#f92672">[</span>master213 localhost<span style="color:#f92672">]</span> and IPs <span style="color:#f92672">[</span>xxx 127.0.0.1 ::1<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>certs<span style="color:#f92672">]</span> Generating <span style="color:#e6db74">&#34;apiserver-etcd-client&#34;</span> certificate and key
<span style="color:#f92672">[</span>certs<span style="color:#f92672">]</span> Generating <span style="color:#e6db74">&#34;etcd/healthcheck-client&#34;</span> certificate and key
<span style="color:#f92672">[</span>certs<span style="color:#f92672">]</span> Generating <span style="color:#e6db74">&#34;etcd/server&#34;</span> certificate and key
<span style="color:#f92672">[</span>certs<span style="color:#f92672">]</span> etcd/server serving cert is signed <span style="color:#66d9ef">for</span> DNS names <span style="color:#f92672">[</span>master213 localhost<span style="color:#f92672">]</span> and IPs <span style="color:#f92672">[</span>xxx 127.0.0.1 ::1 <span style="color:#e6db74">${</span>VIP<span style="color:#e6db74">}</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>certs<span style="color:#f92672">]</span> Generating <span style="color:#e6db74">&#34;apiserver&#34;</span> certificate and key
<span style="color:#f92672">[</span>certs<span style="color:#f92672">]</span> apiserver serving cert is signed <span style="color:#66d9ef">for</span> DNS names <span style="color:#f92672">[</span>master213 kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local<span style="color:#f92672">]</span> and IPs <span style="color:#f92672">[</span>10.96.0.1 xxx <span style="color:#e6db74">${</span>VIP<span style="color:#e6db74">}</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>certs<span style="color:#f92672">]</span> Generating <span style="color:#e6db74">&#34;apiserver-kubelet-client&#34;</span> certificate and key
<span style="color:#f92672">[</span>certs<span style="color:#f92672">]</span> valid certificates and keys now exist in <span style="color:#e6db74">&#34;/etc/kubernetes/pki&#34;</span>
<span style="color:#f92672">[</span>certs<span style="color:#f92672">]</span> Using the existing <span style="color:#e6db74">&#34;sa&#34;</span> key
<span style="color:#f92672">[</span>kubeconfig<span style="color:#f92672">]</span> Writing <span style="color:#e6db74">&#34;admin.conf&#34;</span> kubeconfig file
<span style="color:#f92672">[</span>kubeconfig<span style="color:#f92672">]</span> Writing <span style="color:#e6db74">&#34;controller-manager.conf&#34;</span> kubeconfig file
<span style="color:#f92672">[</span>kubeconfig<span style="color:#f92672">]</span> Writing <span style="color:#e6db74">&#34;scheduler.conf&#34;</span> kubeconfig file
<span style="color:#f92672">[</span>etcd<span style="color:#f92672">]</span> Checking Etcd cluster health
<span style="color:#f92672">[</span>kubelet<span style="color:#f92672">]</span> Downloading configuration <span style="color:#66d9ef">for</span> the kubelet from the <span style="color:#e6db74">&#34;kubelet-config-1.13&#34;</span> ConfigMap in the kube-system namespace
<span style="color:#f92672">[</span>kubelet-start<span style="color:#f92672">]</span> Writing kubelet configuration to file <span style="color:#e6db74">&#34;/var/lib/kubelet/config.yaml&#34;</span>
<span style="color:#f92672">[</span>kubelet-start<span style="color:#f92672">]</span> Writing kubelet environment file with flags to file <span style="color:#e6db74">&#34;/var/lib/kubelet/kubeadm-flags.env&#34;</span>
<span style="color:#f92672">[</span>kubelet-start<span style="color:#f92672">]</span> Activating the kubelet service
<span style="color:#f92672">[</span>tlsbootstrap<span style="color:#f92672">]</span> Waiting <span style="color:#66d9ef">for</span> the kubelet to perform the TLS Bootstrap...
<span style="color:#f92672">[</span>patchnode<span style="color:#f92672">]</span> Uploading the CRI Socket information <span style="color:#e6db74">&#34;/var/run/dockershim.sock&#34;</span> to the Node API object <span style="color:#e6db74">&#34;master213&#34;</span> as an annotation
<span style="color:#f92672">[</span>etcd<span style="color:#f92672">]</span> Announced new etcd member joining to the existing etcd cluster
<span style="color:#f92672">[</span>etcd<span style="color:#f92672">]</span> Wrote Static Pod manifest <span style="color:#66d9ef">for</span> a local etcd instance to <span style="color:#e6db74">&#34;/etc/kubernetes/manifests/etcd.yaml&#34;</span>
<span style="color:#f92672">[</span>uploadconfig<span style="color:#f92672">]</span> storing the configuration used in ConfigMap <span style="color:#e6db74">&#34;kubeadm-config&#34;</span> in the <span style="color:#e6db74">&#34;kube-system&#34;</span> Namespace
<span style="color:#f92672">[</span>mark-control-plane<span style="color:#f92672">]</span> Marking the node master213 as control-plane by adding the label <span style="color:#e6db74">&#34;node-role.kubernetes.io/master=&#39;&#39;&#34;</span>
<span style="color:#f92672">[</span>mark-control-plane<span style="color:#f92672">]</span> Marking the node master213 as control-plane by adding the taints <span style="color:#f92672">[</span>node-role.kubernetes.io/master:NoSchedule<span style="color:#f92672">]</span>

This node has joined the cluster and a new control plane instance was created:

* Certificate signing request was sent to apiserver and approval was received.
* The Kubelet was informed of the new secure connection details.
* Master label and taint were applied to the new node.
* The Kubernetes control plane instances scaled up.
* A new etcd member was added to the local/stacked etcd cluster.

To start administering your cluster from this node, you need to run the following as a regular user:

        mkdir -p $HOME/.kube
        sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
        sudo chown <span style="color:#66d9ef">$(</span>id -u<span style="color:#66d9ef">)</span>:<span style="color:#66d9ef">$(</span>id -g<span style="color:#66d9ef">)</span> $HOME/.kube/config

Run <span style="color:#e6db74">&#39;kubectl get nodes&#39;</span> to see this node join the cluster.

</code></pre></div>
            </div>
        </article>

        <hr />

        <div class="post-info">
  				<p>
  					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://pytimer.github.io/tags/kubeadm">kubeadm</a></span><span class="tag"><a href="https://pytimer.github.io/tags/cncf">CNCF</a></span>
  				</p>
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
                <span><a href="https://pytimer.github.io/">Pytimer</a></span>
            
            
            <span> <a href="https://pytimer.github.io/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.dc716e9092c9820b77f96da294d0120aeeb189b5bcea9752309ebea27fd53bbe6b13cffb2aca8ecf32525647ceb7001f76091de4199ac5a3caa432c070247f5b.js" integrity="sha512-3HFukJLJggt3&#43;W2ilNASCu6xibW86pdSMJ6&#43;on/VO75rE8/7KsqOzzJSVkfOtwAfdgkd5BmaxaPKpDLAcCR/Ww=="></script>



    </body>
</html>
